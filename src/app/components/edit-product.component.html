<div class="edit-product container">
  <h2>Edit Product</h2>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label class="form-label">Name</label>
      <input class="form-control" formControlName="name" />
      <div *ngIf="productForm.get('name')?.touched && productForm.get('name')?.invalid" class="text-danger small">
        Name is required (max 150 chars).
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Description</label>
      <textarea class="form-control" rows="4" formControlName="description"></textarea>
      <div *ngIf="productForm.get('description')?.touched && productForm.get('description')?.invalid" class="text-danger small">
        Description is required.
      </div>
    </div>

    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Price</label>
        <input type="number" class="form-control" formControlName="price" />
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Category <span class="text-danger">*</span></label>
        <select class="form-select" formControlName="categoryId">
          <option value="">Select category</option>
          <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
        </select>
        <div *ngIf="productForm.get('categoryId')?.touched && productForm.get('categoryId')?.invalid" class="text-danger small">
          Category is required.
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Stock</label>
        <input type="number" class="form-control" formControlName="stock" />
      </div>
    </div>

    <div class="mb-3 form-check">
      <input class="form-check-input" type="checkbox" formControlName="isActive" id="activeCheck" />
      <label class="form-check-label" for="activeCheck">Active</label>
    </div>

    <hr />
    <h4>Product Images (Optional)</h4>

    <div class="mb-3">
      <label for="coverImage" class="form-label">Cover Image</label>
      <input 
        type="file" 
        id="coverImage" 
        class="form-control" 
        formControlName="coverImage"
        accept="image/*"
        (change)="onCoverImageSelected($event)"
      />
      <small class="form-text text-muted">Upload the main product cover image (jpg, png, etc.)</small>
    </div>

    <div class="mb-3">
      <label for="galleryImages" class="form-label">Gallery Images</label>
      <input 
        type="file" 
        id="galleryImages" 
        class="form-control" 
        formControlName="galleryImages"
        multiple
        accept="image/*"
        (change)="onGalleryImagesSelected($event)"
      />
      <small class="form-text text-muted">Upload multiple product gallery images</small>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary" [disabled]="submitting">Save</button>
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
    </div>
    <div *ngIf="uploadProgress > 0" class="mt-3">
      <label class="form-label">Uploading images</label>
      <div class="progress">
        <div class="progress-bar" role="progressbar" [style.width.%]="uploadProgress" aria-valuemin="0" aria-valuemax="100">
          {{ uploadProgress }}%
        </div>
      </div>
    </div>
  </form>
</div>
